<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TradeShield Remote Architecture Overview</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #2c3e50;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        h1 { border-bottom: 2px solid #3498db; padding-bottom: 0.3em; }
        h2 { border-bottom: 1px solid #ecf0f1; padding-bottom: 0.2em; }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        pre {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 1em;
            overflow-x: auto;
        }
        pre code {
            background-color: transparent;
            padding: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        blockquote {
            border-left: 4px solid #3498db;
            margin: 1em 0;
            padding-left: 1em;
            color: #666;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        .mermaid {
            text-align: center;
            margin: 2em 0;
            padding: 1em;
            background-color: #f8f8f8;
            border-radius: 4px;
        }
        .pdf-link {
            display: inline-block;
            margin: 10px 0;
            padding: 8px 16px;
            background-color: #e74c3c;
            color: white;
            border-radius: 4px;
            text-decoration: none;
        }
        .pdf-link:hover {
            background-color: #c0392b;
        }
    </style>
    <!-- Mermaid.js for diagram rendering -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body>
    <p><a href="TradeShield-Remote-Architecture-Overview.pdf" class="pdf-link">ðŸ“„ Download PDF Version</a></p>
    <h1 id="tradeshield-remote-architecture-overview">TradeShield Remote - Architecture Overview</h1>
<h2 id="metadata">Metadata</h2>
<p><strong>Category:</strong> Security and Trading Platform Administration
<strong>Last Updated:</strong> 2024-11-29
<strong>Author:</strong> System Administrator
<strong>Version:</strong> 1.0
<strong>Review Date:</strong> 2025-02-28
<strong>Status:</strong> Active</p>
<hr />
<h2 id="purpose">Purpose</h2>
<p>This document provides a comprehensive architectural overview of the TradeShield Remote system, designed to provide secure, high-availability remote administration for critical trading platform infrastructure.</p>
<p><strong>When to Use:</strong>
- Understanding system architecture
- Planning system modifications
- Troubleshooting system issues
- Onboarding new team members</p>
<h3 id="key-architectural-principles">Key Architectural Principles</h3>
<ul>
<li><strong>High Availability:</strong> No single point of failure</li>
<li><strong>Security First:</strong> Zero-trust network access with encryption</li>
<li><strong>Performance:</strong> Optimized for low-latency trading environments</li>
<li><strong>Resilience:</strong> Automated failover and recovery</li>
<li><strong>Monitoring:</strong> Comprehensive health checking and alerting</li>
</ul>
<hr />
<h2 id="system-architecture">System Architecture</h2>
<h3 id="high-level-architecture-diagram">High-Level Architecture Diagram</h3>
<pre class="codehilite"><code class="language-mermaid">graph TB
    subgraph ExternalNetwork[External Network]
        Admin[Administrators&lt;br/&gt;Trading Operations Team]
        ELB[External Load Balancer&lt;br/&gt;HAProxy&lt;br/&gt;TCP 51820/51821]
    end

    subgraph DMZ[DMZ Layer - VPN Gateway]
        CHR1[MikroTik CHR-01&lt;br/&gt;WireGuard Endpoint&lt;br/&gt;192.168.100.1:51820]
        CHR2[MikroTik CHR-02&lt;br/&gt;WireGuard Endpoint&lt;br/&gt;192.168.100.2:51821]
        VIP1[Virtual IP&lt;br/&gt;192.168.100.254&lt;br/&gt;VRRP]
    end

    subgraph InternalNetwork[Internal Network - Administration Layer]
        RS1[RustDesk Server-01&lt;br/&gt;HBBS/HBBR Services&lt;br/&gt;192.168.100.10]
        RS2[RustDesk Server-02&lt;br/&gt;HBBS/HBBR Services&lt;br/&gt;192.168.100.11]
        LB[Internal Load Balancer&lt;br/&gt;Windows NLB&lt;br/&gt;192.168.100.20]
    end

    subgraph TradingInfrastructure[Trading Infrastructure Layer]
        MSSQL[MSSQL Database&lt;br/&gt;Primary Trading Data&lt;br/&gt;192.168.100.30:1433]
        PGSQL[PostgreSQL&lt;br/&gt;Analytics &amp; Reporting&lt;br/&gt;192.168.100.31:5432]
        GOMON[Golang Monitor&lt;br/&gt;Health &amp; Metrics&lt;br/&gt;192.168.100.32:9090]
        TS1[Trading Server 01]
        TS2[Trading Server 02]
        TS13[Trading Server 13]
    end

    subgraph Management[Management &amp; Monitoring]
        Backup[Backup System&lt;br/&gt;Encrypted Storage]
        Monitor[Monitoring Dashboard&lt;br/&gt;Prometheus/Grafana]
        Alert[Alert System&lt;br/&gt;Email/SMS]
    end

    %% Data Flow
    Admin --&gt; ELB
    ELB --&gt; CHR1
    ELB --&gt; CHR2
    CHR1 --&gt; VIP1
    CHR2 --&gt; VIP1
    VIP1 --&gt; RS1
    VIP1 --&gt; RS2
    RS1 --&gt; LB
    RS2 --&gt; LB
    LB --&gt; MSSQL
    LB --&gt; PGSQL
    LB --&gt; GOMON
    LB --&gt; TS1
    LB --&gt; TS2
    LB --&gt; TS13

    %% Monitoring Flow
    Monitor -.-&gt; CHR1
    Monitor -.-&gt; CHR2
    Monitor -.-&gt; RS1
    Monitor -.-&gt; RS2
    Monitor -.-&gt; TradingInfrastructure
    Monitor --&gt; Alert
    Backup -.-&gt; CHR1
    Backup -.-&gt; CHR2
    Backup -.-&gt; RS1
    Backup -.-&gt; RS2

    style ExternalNetwork fill:#e3f2fd
    style DMZ fill:#fff3e0
    style InternalNetwork fill:#e8f5e8
    style TradingInfrastructure fill:#f3e5f5
    style Management fill:#ffebee
</code></pre>

<h3 id="network-segmentation-security-zones">Network Segmentation &amp; Security Zones</h3>
<pre class="codehilite"><code class="language-mermaid">graph LR
    subgraph Internet[Internet - Untrusted]
        A[Administrator Workstations]
    end

    subgraph DMZ[DMZ - Semi-Trusted]
        B[WireGuard VPN Gateways]
    end

    subgraph AdminNetwork[Admin Network - Trusted]
        C[RustDesk Cluster]
    end

    subgraph TradingNetwork[Trading Network - Highly Restricted]
        D[Database Servers]
        E[Trading Applications]
    end

    A -- Encrypted WireGuard&lt;br/&gt;UDP 51820/51821 --&gt; B
    B -- Authenticated TLS&lt;br/&gt;TCP 21115-21119 --&gt; C
    C -- Restricted Access&lt;br/&gt;Specific Ports Only --&gt; D
    C -- Restricted Access&lt;br/&gt;Specific Ports Only --&gt; E

    style Internet fill:#ffebee
    style DMZ fill:#fff3e0
    style AdminNetwork fill:#e8f5e8
    style TradingNetwork fill:#f3e5f5
</code></pre>

<hr />
<h2 id="component-architecture">Component Architecture</h2>
<h3 id="vpn-gateway-layer-mikrotik-chr">VPN Gateway Layer (MikroTik CHR)</h3>
<h4 id="design-rationale">Design Rationale</h4>
<ul>
<li><strong>High Availability:</strong> Dual CHR instances with VRRP</li>
<li><strong>Security:</strong> WireGuard protocol with perfect forward secrecy</li>
<li><strong>Performance:</strong> Minimal latency for trading operations</li>
<li><strong>Resilience:</strong> Automatic failover with health checks</li>
</ul>
<h4 id="component-details">Component Details</h4>
<table>
<thead>
<tr>
<th>Component</th>
<th>IP Address</th>
<th>WireGuard Port</th>
<th>VRRP Priority</th>
<th>Role</th>
</tr>
</thead>
<tbody>
<tr>
<td>CHR-Primary</td>
<td>192.168.100.1</td>
<td>51820</td>
<td>254</td>
<td>Active</td>
</tr>
<tr>
<td>CHR-Secondary</td>
<td>192.168.100.2</td>
<td>51821</td>
<td>100</td>
<td>Standby</td>
</tr>
<tr>
<td>Virtual IP</td>
<td>192.168.100.254</td>
<td>N/A</td>
<td>N/A</td>
<td>VRRP</td>
</tr>
</tbody>
</table>
<h4 id="data-flow">Data Flow</h4>
<pre class="codehilite"><code class="language-mermaid">sequenceDiagram
    participant A as Administrator
    participant CHR1 as CHR Primary
    participant CHR2 as CHR Secondary
    participant VRRP as VRRP Protocol

    Note over A,VRRP: Normal Operation
    A-&gt;&gt;CHR1: WireGuard Connection
    CHR1-&gt;&gt;VRRP: Advertisement (Priority 254)
    VRRP-&gt;&gt;CHR2: Standby Mode

    Note over A,VRRP: Failover Scenario
    CHR1-&gt;&gt;VRRP: Stop Advertisements
    VRRP-&gt;&gt;CHR2: Become Master (Priority 100)
    A-&gt;&gt;CHR2: Reconnect WireGuard
    CHR2-&gt;&gt;VRRP: Advertisement (Priority 100)
</code></pre>

<h3 id="rustdesk-administration-layer">RustDesk Administration Layer</h3>
<h4 id="cluster-architecture">Cluster Architecture</h4>
<pre class="codehilite"><code class="language-mermaid">graph TB
    subgraph RustDeskCluster[RustDesk High Availability Cluster]
        RS1[Server-01&lt;br/&gt;192.168.100.10]
        RS2[Server-02&lt;br/&gt;192.168.100.11]
        LB[Load Balancer&lt;br/&gt;192.168.100.20]
    end

    subgraph Services[Containerized Services]
        HBBS1[HBBS-01&lt;br/&gt;ID Server]
        HBBR1[HBBR-01&lt;br/&gt;Relay Server]
        HBBS2[HBBS-02&lt;br/&gt;ID Server]
        HBBR2[HBBR-02&lt;br/&gt;Relay Server]
    end

    subgraph Network[Network Configuration]
        DOCKER[Docker Network&lt;br/&gt;192.168.100.0/24]
        PORTS[Ports 21115-21119]
    end

    RS1 --&gt; HBBS1
    RS1 --&gt; HBBR1
    RS2 --&gt; HBBS2
    RS2 --&gt; HBBR2
    HBBS1 --&gt; LB
    HBBS2 --&gt; LB
    HBBR1 --&gt; LB
    HBBR2 --&gt; LB

    style RustDeskCluster fill:#e8f5e8
    style Services fill:#f3e5f5
    style Network fill:#fff3e0
</code></pre>

<h4 id="service-port-mapping">Service Port Mapping</h4>
<table>
<thead>
<tr>
<th>Service</th>
<th>Port</th>
<th>Protocol</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>HBBS</td>
<td>21115</td>
<td>TCP</td>
<td>ID Server Main</td>
</tr>
<tr>
<td>HBBS</td>
<td>21116</td>
<td>TCP/UDP</td>
<td>ID Server NAT</td>
</tr>
<tr>
<td>HBBS</td>
<td>21118</td>
<td>TCP</td>
<td>ID Server Web</td>
</tr>
<tr>
<td>HBBR</td>
<td>21117</td>
<td>TCP</td>
<td>Relay Server</td>
</tr>
<tr>
<td>HBBR</td>
<td>21119</td>
<td>TCP</td>
<td>Relay Server Web</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="security-architecture">Security Architecture</h2>
<h3 id="defense-in-depth-strategy">Defense in Depth Strategy</h3>
<pre class="codehilite"><code class="language-mermaid">graph TB
    subgraph L1[Layer 1: Perimeter Security]
        ELB[External Load Balancer]
        FW1[Port Filtering 51820/51821]
        RL[Rate Limiting]
    end

    subgraph L2[Layer 2: VPN Security]
        WG[WireGuard Encryption]
        AUTH[Certificate Authentication]
        GEO[GeoIP Filtering]
    end

    subgraph L3[Layer 3: Internal Security]
        FW2[Internal Firewall Rules]
        SEG[Network Segmentation]
        ACL[Access Control Lists]
    end

    subgraph L4[Layer 4: Application Security]
        TLS[Transport Security]
        RBAC[Role-Based Access]
        AUDIT[Audit Logging]
    end

    L1 --&gt; L2
    L2 --&gt; L3
    L3 --&gt; L4

    style L1 fill:#ffebee
    style L2 fill:#fff3e0
    style L3 fill:#e8f5e8
    style L4 fill:#f3e5f5
</code></pre>

<h3 id="wireguard-security-model">WireGuard Security Model</h3>
<ul>
<li><strong>Protocol:</strong> UDP</li>
<li><strong>Encryption:</strong> ChaCha20</li>
<li><strong>Authentication:</strong> Poly1305</li>
<li><strong>Key Exchange:</strong> Curve25519</li>
<li><strong>Perfect Forward Secrecy:</strong> Enabled</li>
<li><strong>Handshake:</strong> Noise_IK</li>
</ul>
<h3 id="access-control-matrix">Access Control Matrix</h3>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Access From</th>
<th>Ports</th>
<th>Protocol</th>
<th>Authentication</th>
</tr>
</thead>
<tbody>
<tr>
<td>CHR Management</td>
<td>Internal Network</td>
<td>2222</td>
<td>TCP</td>
<td>SSH Keys</td>
</tr>
<tr>
<td>WireGuard VPN</td>
<td>Internet</td>
<td>51820-51821</td>
<td>UDP</td>
<td>WireGuard Keys</td>
</tr>
<tr>
<td>RustDesk Services</td>
<td>WireGuard Network</td>
<td>21115-21119</td>
<td>TCP</td>
<td>RustDesk Key</td>
</tr>
<tr>
<td>MSSQL Database</td>
<td>RustDesk Network</td>
<td>1433, 5022</td>
<td>TCP</td>
<td>Windows Auth</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>RustDesk Network</td>
<td>5432</td>
<td>TCP</td>
<td>Database Auth</td>
</tr>
<tr>
<td>Monitoring</td>
<td>Internal Network</td>
<td>9090</td>
<td>TCP</td>
<td>API Key</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="high-availability-design">High Availability Design</h2>
<h3 id="failover-scenarios">Failover Scenarios</h3>
<h4 id="chr-failover-sequence">CHR Failover Sequence</h4>
<pre class="codehilite"><code class="language-mermaid">sequenceDiagram
    participant M as Monitor
    participant C1 as CHR Primary
    participant C2 as CHR Secondary
    participant V as VRRP
    participant A as Administrator

    Note over M,C2: Normal Operation
    M-&gt;&gt;C1: Health Check
    C1-&gt;&gt;M: Status OK
    C1-&gt;&gt;V: Advertise (Priority 254)

    Note over M,C2: Failure Detection
    M-&gt;&gt;C1: Health Check Failed
    M-&gt;&gt;V: Trigger Failover
    V-&gt;&gt;C2: Increase Priority to 254
    C2-&gt;&gt;V: Advertise (Priority 254)
    V-&gt;&gt;C1: Demote to 100

    Note over M,C2: Client Reconnection
    A-&gt;&gt;C2: Automatic Reconnect
    C2-&gt;&gt;A: Establish New Tunnel

    Note over M,C2: Recovery
    M-&gt;&gt;C1: Health Check Restored
    C1-&gt;&gt;V: Advertise (Priority 254)
    V-&gt;&gt;C2: Restore Priority to 100
</code></pre>

<h4 id="rustdesk-failover-mechanism">RustDesk Failover Mechanism</h4>
<ul>
<li><strong>Type:</strong>** Windows Network Load Balancing</li>
<li><strong>Mode:</strong> Unicast</li>
<li><strong>Affinity:</strong> Single</li>
<li><strong>Timeout:</strong> 2 seconds</li>
<li><strong>Health Check:</strong> TCP 21115</li>
</ul>
<p><strong>Failover Triggers:</strong>
- Service unresponsive for 15 seconds
- Container health check failure
- Network connectivity loss
- Resource exhaustion</p>
<hr />
<h2 id="performance-scalability">Performance &amp; Scalability</h2>
<h3 id="capacity-planning">Capacity Planning</h3>
<p><strong>CHR Instances:</strong>
- Memory: 2 GB each
- vCPUs: 2 each
- Storage: 20 GB each
- Network: 1 Gbps</p>
<p><strong>RustDesk Instances:</strong>
- Memory: 4 GB each
- vCPUs: 4 each
- Storage: 40 GB each
- Network: 1 Gbps</p>
<p><strong>Expected Capacity:</strong>
- Concurrent Admins: Up to 50
- Trading Servers: 13 + growth
- Database Connections: Unlimited via load balancing</p>
<h3 id="performance-targets">Performance Targets</h3>
<ul>
<li><strong>Latency:</strong> &lt; 50ms round-trip for administration</li>
<li><strong>Availability:</strong> 99.95% uptime (4.38 hours downtime/year)</li>
<li><strong>Failover:</strong> &lt; 30 seconds automatic failover</li>
<li><strong>Backup:</strong> Complete system restore within 2 hours</li>
</ul>
<hr />
<h2 id="disaster-recovery">Disaster Recovery</h2>
<h3 id="recovery-time-objectives">Recovery Time Objectives</h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>RTO</th>
<th>RPO</th>
<th>Recovery Method</th>
</tr>
</thead>
<tbody>
<tr>
<td>CHR Configuration</td>
<td>15 minutes</td>
<td>24 hours</td>
<td>Automated restore</td>
</tr>
<tr>
<td>RustDesk Data</td>
<td>30 minutes</td>
<td>12 hours</td>
<td>Volume snapshot</td>
</tr>
<tr>
<td>Database Access</td>
<td>Immediate</td>
<td>N/A</td>
<td>Load balancer failover</td>
</tr>
<tr>
<td>Full System</td>
<td>2 hours</td>
<td>24 hours</td>
<td>Complete redeployment</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="operational-considerations">Operational Considerations</h2>
<h3 id="maintenance-windows">Maintenance Windows</h3>
<ul>
<li><strong>CHR Updates:</strong> Monthly, during trading off-hours</li>
<li><strong>RustDesk Updates:</strong> Quarterly, with rolling deployment</li>
<li><strong>Security Patches:</strong> Emergency, with failover protection</li>
<li><strong>Backup Validation:</strong> Weekly automated testing</li>
</ul>
<h3 id="monitoring-alerting">Monitoring &amp; Alerting</h3>
<p><strong>Critical Alerts:</strong>
- VPN tunnel failure
- RustDesk service down
- Database connectivity loss
- High latency detected</p>
<p><strong>Warning Alerts:</strong>
- High resource utilization
- Backup failures
- Certificate expiration
- Security event detected</p>
<hr />
<h2 id="related-procedures">Related Procedures</h2>
<ul>
<li><a href="TradeShield-Remote-Deployment.md">TradeShield Remote - Deployment Guide</a> - Step-by-step deployment procedure</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://help.mikrotik.com/docs/display/ROS/CHR">MikroTik CHR Documentation</a></li>
<li><a href="https://www.wireguard.com/protocol/">WireGuard Protocol</a></li>
<li><a href="https://rustdesk.com/docs/en/self-host/">RustDesk Server Setup</a></li>
<li><a href="https://tools.ietf.org/html/rfc5798">VRRP Protocol</a></li>
</ul>
<h2 id="change-log">Change Log</h2>
<table>
<thead>
<tr>
<th>Date</th>
<th>Version</th>
<th>Author</th>
<th>Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td>2024-11-29</td>
<td>1.0</td>
<td>System Administrator</td>
<td>Initial version</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="notes">Notes</h2>
<p><strong>NOTE:</strong> This is a reference document. For deployment procedures, see <a href="TradeShield-Remote-Deployment.md">TradeShield Remote - Deployment Guide</a>.</p>
<p><strong>TIP:</strong> Review this architecture document before making any system modifications.</p>
</body>
</html>